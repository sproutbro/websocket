# ✅ WebSocket 채팅 서버 - 1단계 요약 정리

이 문서는 WebSocket 서버 구현 1단계에서 작성된 기능과 구조를 기준으로,
각 기능별 **역할**, **디자인 패턴**, **구현 이유**, **예상 장점**을 정리한 문서입니다.

---

## 1. WebSocket 업그레이드 핸들러 (`ServeWS`)

- **역할**: HTTP 요청을 WebSocket 연결로 업그레이드
- **사용 패턴**: Decorator 패턴 (미들웨어로 감싸는 확장 가능한 구조)
- **구현 이유**:
  - 클라이언트 요청을 WebSocket으로 전환
  - 추후 미들웨어(로깅, 인증 등)로 감싸기 좋게 설계
- **예상 장점**:
  - 요청 확장성, 테스트 용이, CORS 등 환경 설정 분리 가능

---

## 2. Hub 구조 (`hub.go`)

- **역할**: 모든 클라이언트의 중앙 관리자 역할
- **사용 패턴**: Mediator + Singleton
- **구현 이유**:
  - 클라이언트 목록을 통합 관리
  - 메시지 브로드캐스트 처리
- **예상 장점**:
  - 클라이언트 간 직접 의존 없이 연결 가능
  - 모든 메시지 흐름을 한 지점에서 제어 (확장성↑, 테스트 쉬움)

---

## 3. 클라이언트 객체 (`client.go`)

- **역할**: WebSocket 연결된 사용자 한 명 표현
- **사용 패턴**: Observer + Strategy 유사
- **구현 이유**:
  - 사용자 개별 send 버퍼 및 메시지 루프 운영
  - 메시지 전송/수신을 각각의 루틴으로 분리
- **예상 장점**:
  - 동시성 문제 해결 (채널 기반)
  - 메시지 전략 확장 가능 (예: 자동 응답, 커맨드 처리 등)

---

## 4. 메시지 포맷 파싱 (`message.go`)

- **역할**: 클라이언트 간 주고받는 메시지 구조 및 파싱 유효성 검사
- **사용 패턴**: Value Object + Validation
- **구현 이유**:
  - 메시지 타입, 사용자명, 본문을 명확히 분리
  - 잘못된 메시지는 필터링
- **예상 장점**:
  - 다양한 메시지 타입 확장 가능 (join, leave, chat 등)
  - 테스트 코드에서 포맷 검증 용이

---

## 5. 테스트 코드 (`message_test.go`, `ServeWS` 테스트)

- **역할**: 메시지 유효성 검증, 업그레이드 시나리오 확인
- **사용 패턴**: Table-driven Test + Mock Object
- **구현 이유**:
  - 다양한 입력 케이스에 대한 정확한 파싱 확인
  - 업그레이드 실패/성공 상황 검증
- **예상 장점**:
  - 안정적인 기능 배포 기반
  - 기능 리팩터링 시 회귀 버그 방지

---

## 📌 향후 확장 포인트

| 기능 | 예상 적용 패턴 | 설명 |
|------|----------------|------|
| 메시지 핸들링 분기 | Factory Method + Command | chat, join 등 메시지 타입별 로직 분리 |
| 사용자 상태 관리 | State / Strategy | 연결 상태, 채팅 상태별 동작 분리 |
| 룸 기능 | Composite + Observer | 방 생성/입장/퇴장 기능 확장 |
| 미들웨어 확장 | Decorator | 인증, 로깅, 버전 관리 등 미들웨어 체인 구축 |

---

## ✅ 현재까지의 핵심 디자인 패턴 정리

| 패턴명 | 적용 위치 | 목적 |
|--------|-----------|------|
| **Decorator** | `ServeWS`, 미들웨어 | 기능 확장/추가 유연성 |
| **Mediator** | `Hub` | 중앙 집중 메시지 관리 |
| **Observer** | `Client` → `Hub` | 메시지 수신/전파 구조 구성 |
| **Singleton** | `Hub` 인스턴스 공유 | 전역 통합 관리 |
| **Strategy 유사** | 메시지 처리 흐름 | 메시지 처리 전략 분리 |
| **Table-driven Test** | `message_test.go` | 다양한 입력 검증 유연성 |
| **Mock Object** | `ServeWS` 테스트 | 외부 의존성 제거한 테스트

---

🧠 **TDD + 객체 분리 + 확장성 설계**  
→ 다음 기능 (메시지 라우팅, 게임 도입 등)으로도 깔끔하게 이어질 수 있게 준비 완료!

